api-version: reviewpad.com/v3.x

labels:
  size/xs:
    color: '5D9801'
    description: 'Denotes a change 0-9 lines'
  size/S:
    color: '5D9801'
    description: 'Denotes a change 10-29 lines'
  size/M:
    color: '7F7203'
    description: 'Denotes a change 30-99 lines'
  size/L:
    color: 'A14C05'
    description: 'Denotes a change 100-499 lines'
  size/XL:
    color: 'C32607'
    description: 'Denotes a change 500-999 lines'
  size/XXL:
    color: 'E50009'
    description: 'Denotes a change 1000+ lines'

rules:
  - name: hasLinkedIssues
    kind: patch
    description: Verifies if the pull request has linked issues
    spec: $hasLinkedIssues()

workflows:
  - name: label-pull-request-with-size
    if:
      - rule: $size() <= 9
        extra-actions:
          - $addLabel("size/XS")
          - $removeLabel("size/S")
          - $removeLabel("size/M")
          - $removeLabel("size/L")
          - $removeLabel("size/XL")
          - $removeLabel("size/XXL")
      - rule: $size() >= 10 && $size() <= 29
        extra-actions:
          - $addLabel("size/S")
          - $removeLabel("size/XS")
          - $removeLabel("size/M")
          - $removeLabel("size/L")
          - $removeLabel("size/XL")
          - $removeLabel("size/XXL")
      - rule: $size() >= 20 && $size() <= 99
        extra-actions:
          - $addLabel("size/M")
          - $removeLabel("size/XS")
          - $removeLabel("size/S")
          - $removeLabel("size/L")
          - $removeLabel("size/XL")
          - $removeLabel("size/XXL")
      - rule: $size() >= 100 && $size() <= 499
        extra-actions:
          - $addLabel("size/L")
          - $removeLabel("size/XS")
          - $removeLabel("size/S")
          - $removeLabel("size/M")
          - $removeLabel("size/XL")
          - $removeLabel("size/XXL")
      - rule: $size() >= 500 && $size() <= 999
        extra-actions:
          - $addLabel("size/XL")
          - $removeLabel("size/XS")
          - $removeLabel("size/S")
          - $removeLabel("size/M")
          - $removeLabel("size/L")
          - $removeLabel("size/XXL")
      - rule: $size() >= 1000
        extra-actions:
          - $addLabel("size/XXL")
          - $removeLabel("size/XS")
          - $removeLabel("size/S")
          - $removeLabel("size/M")
          - $removeLabel("size/L")
          - $removeLabel("size/XL")

  - name: pull-request-count
    always-run: true
    if:
      - rule: $pullRequestCountBy($author(), "all") == 1
        extra-actions:
          - '$commentOnce($sprintf("Welcome @%v! Thank you so much for your first pull request!", [$author()]))'

      - rule: $pullRequestCountBy($author(), "all") == 2
        extra-actions:
          - $commentOnce("Thanks for your second pull request!")

      - rule: $pullRequestCountBy($author(), "all") == 5
        extra-actions:
          - $commentOnce("Thanks for your fifth pull request!")

      - rule: $pullRequestCountBy($author(), "all") == 10
        extra-actions:
          - $commentOnce("Thanks for your tenth pull request!")

  - name: waiting-for-review
    always-run: true
    if:
      - rule: $reviewers() == []
        extra-actions:
          - '$commentOnce("A maintainer will review your pull request soon!")'
          - '$addLabel("üîç pull: waiting for review")'

  - name: waiting-for-review-remove
    always-run: true
    if:
      - rule: $reviewers() != []
        extra-actions:
          - '$removeLabel("üîç pull: waiting for review")'

  - name: is-draft
    always-run: true
    if:
      - rule: $isDraft()
        extra-actions:
          - '$info("This pull request is marked as draft. Please mark it as ready for review when you are done.")'
          - '$addLabel("‚öíÔ∏è pull: work in progress")'
    else:
      - rule: !$isDraft()
        extra-actions:
          - '$removeLabel("‚öíÔ∏è pull: work in progress")'

  - name: has-linked-issue
    always-run: true
    if:
      - rule: $hasLinkedIssue()
        extra-actions:
          - '$info("This pull request is linked to an issue. Please make sure to close the issue when this pull request is merged.")'
          - '$info("You can use the following keywords in the pull request description to close the issue automatically: close, closes, closed, fix, fixes, fixed, resolve, resolves, resolved (e.g. closes #issue-number)")'
          - '$addLabel("üîó pull: linked issue")'
    else:
      - rule: !$hasLinkedIssue()
        extra-actions:
          - '$removeLabel("üîó pull: linked issue")'

  - name: add-label-for-documentation
    always-run: true
    if:
      - rule: $hasFilePattern("**.md")
        extra-actions:
          - '$addLabel("üìÑ aspect: text")'

  - name: add-label-for-dependency
    always-run: true
    if:
      - rule: $hasFilePattern("package.json")
        extra-actions:
          - '$addLabel("üì¶ aspect: dependencies")'

  - name: label-pull-requests-with-git-conflicts
    if:
      - '$hasGitConflicts()'
    then:
      - '$addLabel("conflicts")'
